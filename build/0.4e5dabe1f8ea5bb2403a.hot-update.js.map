{"version":3,"file":"0.4e5dabe1f8ea5bb2403a.hot-update.js","sources":["webpack:///src/server/controller/user.js"],"sourcesContent":["import userModel from '../model/user';\nconst { resCodes } = require('../config'); \n\nconst userCtrl = {};\n\nuserCtrl.regist = async function (req, res, next) {\n  const { username, password } = req.body;\n  try {\n    const result = await userModel.create(username, password);\n    // const docResult = await userModel.fetchUserInfo(result.user_id);    \n    req.session.login = true;\n    req.session.username = username;\n    req.session.userId = result.insertId;\n    res.status(200).send({\n      code: resCodes.OK,\n      msg: '创建成功',\n      docs: [],\n    });\n  } catch (err) {\n    console.log(err);\n    if (err.code === 'ER_DUP_ENTRY') {\n      res.status(200).send({\n        code: resCodes.USERNAME_REPEAT,\n        msg: '账号重复',\n      });\n    }\n  }\n};\n\nuserCtrl.login = async function (req, res, next) {\n  const { username, password } = req.body;\n  try {\n    const result = await userModel.confirm(username, password);\n    const docResult = await userModel.fetchUserInfo(result.user_id);\n    console.log(req);\n    console.log(req.session);\n    req.session.login = true;\n    req.session.username = username;\n    req.session.userId = result.user_id;\n    res.status(200).send({\n      code: resCodes.OK,\n      msg: '登录成功',\n      docs: docResult,\n    });\n  } catch (err) {\n    if (err.code === 'NO_EQUAL') {\n      res.status(200).send({\n        code: resCodes.PASSWORD_NO_EQUAL,\n        msg: '密码错误',\n      });\n    } else if (err.code === 'EMPTY') {\n      res.status(200).send({\n        code: resCodes.USERNAME_NO_EXIST,\n        msg: '账号不存在',\n      });\n    }\n    console.log(err);\n  }\n};\n\nuserCtrl.logout = async function (req, res) {\n  console.log('logout');\n  if (req.session) {\n    req.session.login = false;\n  }\n  res.status(200).send({\n    code: resCodes.OK,\n    msg: '登出成功',\n  });\n};\n\nuserCtrl.check = async function (req, res) {\n  try {\n    if (req.session.login) {\n      const { userId, username } = req.session;\n      const docResult = await userModel.fetchUserInfo(userId);\n      res.status(200).send({\n        code: resCodes.OK,\n        msg: '账号已登录',\n        docs: docResult,\n        username,\n      });\n    } else {\n      res.status(200).send({\n        code: resCodes.NO_LOGIN,\n        msg: '账号未登录',\n      });\n    }\n  } catch (err) {\n    res.status(200).send({\n      code: resCodes.NO_LOGIN,\n      msg: err.msg || err.message || err,\n    });\n  }\n};\n\nexport default  userCtrl;\n\n\n\n// WEBPACK FOOTER //\n// src/server/controller/user.js"],"mappings":";;;;;;;;;;;;;;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAGA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AARA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AAaA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AArBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AAuBA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAGA;AAHA;AAAA;AACA;AADA;AAIA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AAVA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AAeA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AA5BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AA8BA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AACA;AANA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AAUA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAIA;AACA;AAAA;AACA;AACA;AACA;AACA;AAJA;AALA;AAAA;AACA;AADA;AAYA;AACA;AACA;AAFA;AACA;AAbA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AAiBA;AACA;AACA;AAFA;AACA;AAnBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AAwBA;;;;A","sourceRoot":""}